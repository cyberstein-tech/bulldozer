const renderer=PIXI.autoDetectRenderer({antialias:!0,autoDensity:!0,resolution:window.devicePixelRatio,width:320,height:256,backgroundColor:8421376,autoResize:!0});let stage,tilemap,frame=0,bulldozerRow,bulldozerCol,size=16,levelSetArray=[],levelArray=[],mapArray=[],lastMoveArray=[],currentLevel=0,levelSet=-1,levelSolved=!1;const messages=["Good job!","Awesome!","Props!","Way to go!","Nailed it!","Good Game!","Kudos!","Hats off!","A round of applause...","Keep going!","Slow poke..","Slow down!","Nice!","Take it easy on the caffeine, sheeez","Almost there..","Boom!","Yay, now take a break!","Okay, take a stretch now!","You do not give up, nice!","Bazinga!"],maxRows=16,maxCols=20;let unfillSum,fillSum,bullseyeSum;createMapArray(maxRows,maxCols),loadMap(0),document.getElementById("canvas").appendChild(renderer.view);const loader=new PIXI.Loader;let css_width=window.innerWidth;640<=css_width?(renderer.resize(640,512),size=32,loader.add("TilemapLegend","assets/TilemapLegend32.json")):css_width<640&&480<=css_width?(renderer.resize(480,384),size=24,loader.add("TilemapLegend","assets/TilemapLegend24.json")):loader.add("TilemapLegend","assets/TilemapLegend16.json"),loader.load((l,e)=>{stage=new PIXI.Container,tilemap=new PIXI.tilemap.CompositeTilemap,stage.addChild(tilemap),PIXI.Ticker.shared.add(()=>renderer.render(stage)),makeTilemap()});var modal=document.getElementById("myModal");let span=document.getElementsByClassName("close")[0];function makeTilemap(){tilemap.clear();for(let e=fillSum=0;e<20;e++)for(let l=0;l<16;l++){var o=mapArray[l][e];o<0?-8===o?tilemap.tile("brick8.png",e*size,l*size):-7===o?tilemap.tile("brick7.png",e*size,l*size):-6===o?tilemap.tile("brick6.png",e*size,l*size):-5===o?tilemap.tile("brick5.png",e*size,l*size):-4===o?tilemap.tile("brick4.png",e*size,l*size):-3===o?tilemap.tile("brick3.png",e*size,l*size):-2===o?tilemap.tile("brick2.png",e*size,l*size):tilemap.tile("brick1.png",e*size,l*size):0<o&&(1===o?tilemap.tile("bullseye.png",e*size,l*size):2===o?tilemap.tile("boulder.png",e*size,l*size):3===o?(tilemap.tile("bullseye-boulder.png",e*size,l*size),fillSum++):(o%10==4?tilemap.tile("bulldozer-up.png",e*size,l*size):o%10==5?tilemap.tile("bulldozer-down.png",e*size,l*size):o%10==6?tilemap.tile("bulldozer-left.png",e*size,l*size):tilemap.tile("bulldozer-right.png",e*size,l*size),bulldozerRow=l,bulldozerCol=e))}}async function createMapArray(o,r){for(let l=0;l<o;l++)mapArray[l]=[];for(let e=0;e<o;e++)for(let l=0;l<r;l++)mapArray[e][l]=-4;return mapArray}async function getMapSetData(e){e="mapsets/"+e+".txt";try{let l=await fetch(e);if(200===l.status)return l.text();console.log(l.status)}catch(l){console.log(l)}}async function loadMap(e){if(Math.floor(e/10)!=levelSet){levelSet=Math.floor(e/10);let l=await getMapSetData(levelSet);if(null==l)return alert("Unable to fetch map data. Maybe try again?"),null;levelSetArray=[],levelSetArray=l.split(/\r\n|\n\r|\n|\r/)}loadLevelData(e)}async function loadLevelData(l){levelArray=[];var e=l%10;levelArray=levelSetArray[e].split(/\s+/);let o=0;bullseyeSum=0,unfillSum=0;for(let e=fillSum=0;e<maxRows;e++)for(let l=0;l<maxCols;l++)mapArray[e][l]=Number(levelArray[o++]),1===mapArray[e][l]&&unfillSum++,3===mapArray[e][l]&&fillSum++;currentLevel=l,document.getElementById("level").textContent="Level "+currentLevel,bullseyeSum=unfillSum+fillSum,levelSolved=!1}async function restartLevel(){await loadLevelData(currentLevel),makeTilemap()}async function undoLastMove(){mapArray[lastMoveArray[0]][lastMoveArray[1]]=lastMoveArray[2],mapArray[lastMoveArray[3]][lastMoveArray[4]]=lastMoveArray[5],mapArray[lastMoveArray[6]][lastMoveArray[7]]=lastMoveArray[8],makeTilemap()}async function jumpToLevel(l){l&&(await loadMap(l),makeTilemap())}function getLevel(){var l=prompt("Please enter a level number between 0 and 179, inclusive.");!isNaN(l)&&0<=l&&l<180?jumpToLevel(l):alert("Please enter a valid level number. Stop trying to hack me with bad characters.")}function moveBulldozerUp(){var l,e,o;let r=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow-1][bulldozerCol],o=mapArray[bulldozerRow-2][bulldozerCol],!(levelSolved||e<0)){if(0===e)mapArray[bulldozerRow-1][bulldozerCol]=4,r=!0;else if(1===e)mapArray[bulldozerRow-1][bulldozerCol]=14,r=!0;else if(2===e)if(0==o)mapArray[bulldozerRow-1][bulldozerCol]=4,mapArray[bulldozerRow-2][bulldozerCol]=2,r=!0;else{if(1!=o)return;mapArray[bulldozerRow-1][bulldozerCol]=4,mapArray[bulldozerRow-2][bulldozerCol]=3,fillSum++,r=!0}else if(0==o)mapArray[bulldozerRow-1][bulldozerCol]=14,mapArray[bulldozerRow-2][bulldozerCol]=2,fillSum--,r=!0;else{if(1!=o)return;mapArray[bulldozerRow-1][bulldozerCol]=14,mapArray[bulldozerRow-2][bulldozerCol]=3,r=!0}r&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow-1,bulldozerCol,e,bulldozerRow-2,bulldozerCol,o)),updateT0Postion(l)}}function moveBulldozerLeft(){var l,e,o;let r=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow][bulldozerCol-1],o=mapArray[bulldozerRow][bulldozerCol-2],!(levelSolved||e<0)){if(0===e)mapArray[bulldozerRow][bulldozerCol-1]=6,r=!0;else if(1===e)mapArray[bulldozerRow][bulldozerCol-1]=16,r=!0;else if(2===e)if(0==o)mapArray[bulldozerRow][bulldozerCol-1]=6,mapArray[bulldozerRow][bulldozerCol-2]=2,r=!0;else{if(1!=o)return;mapArray[bulldozerRow][bulldozerCol-1]=6,mapArray[bulldozerRow][bulldozerCol-2]=3,fillSum++,r=!0}else if(0==o)mapArray[bulldozerRow][bulldozerCol-1]=16,mapArray[bulldozerRow][bulldozerCol-2]=2,fillSum--,r=!0;else{if(1!=o)return;mapArray[bulldozerRow][bulldozerCol-1]=16,mapArray[bulldozerRow][bulldozerCol-2]=3,r=!0}r&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow,bulldozerCol-1,e,bulldozerRow,bulldozerCol-2,o)),updateT0Postion(l)}}function moveBulldozerRight(){var l,e,o;let r=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow][bulldozerCol+1],o=mapArray[bulldozerRow][bulldozerCol+2],!(levelSolved||e<0)){if(0===e)mapArray[bulldozerRow][bulldozerCol+1]=7,r=!0;else if(1===e)mapArray[bulldozerRow][bulldozerCol+1]=17,r=!0;else if(2===e)if(0==o)mapArray[bulldozerRow][bulldozerCol+1]=7,mapArray[bulldozerRow][bulldozerCol+2]=2,r=!0;else{if(1!=o)return;mapArray[bulldozerRow][bulldozerCol+1]=7,mapArray[bulldozerRow][bulldozerCol+2]=3,fillSum++,r=!0}else if(0==o)mapArray[bulldozerRow][bulldozerCol+1]=17,mapArray[bulldozerRow][bulldozerCol+2]=2,fillSum--,r=!0;else{if(1!=o)return;mapArray[bulldozerRow][bulldozerCol+1]=17,mapArray[bulldozerRow][bulldozerCol+2]=3,r=!0}r&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow,bulldozerCol+1,e,bulldozerRow,bulldozerCol+2,o)),updateT0Postion(l)}}function moveBulldozerDown(){var l,e,o;let r=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow+1][bulldozerCol],o=mapArray[bulldozerRow+2][bulldozerCol],!(levelSolved||e<0)){if(0===e)mapArray[bulldozerRow+1][bulldozerCol]=5,r=!0;else if(1===e)mapArray[bulldozerRow+1][bulldozerCol]=15,r=!0;else if(2===e)if(0==o)mapArray[bulldozerRow+1][bulldozerCol]=5,mapArray[bulldozerRow+2][bulldozerCol]=2,r=!0;else{if(1!=o)return;mapArray[bulldozerRow+1][bulldozerCol]=5,mapArray[bulldozerRow+2][bulldozerCol]=3,fillSum++,r=!0}else if(0==o)mapArray[bulldozerRow+1][bulldozerCol]=15,mapArray[bulldozerRow+2][bulldozerCol]=2,fillSum--,r=!0;else{if(1!=o)return;mapArray[bulldozerRow+1][bulldozerCol]=15,mapArray[bulldozerRow+2][bulldozerCol]=3,r=!0}r&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow+1,bulldozerCol,e,bulldozerRow+2,bulldozerCol,o)),updateT0Postion(l)}}function updateT0Postion(l){if(mapArray[bulldozerRow][bulldozerCol]=10<l?1:0,makeTilemap(),fillSum===bullseyeSum){levelSolved=!0;let l=Number(currentLevel)+1,e=currentLevel%20;setTimeout(()=>{conVal=confirm(messages[e]+"\n\nLoading level "+l+" now..."),conVal&&jumpToLevel(l)},1e3)}}function showAbout(){modal.style.display="block"}document.addEventListener("keydown",function(l){"ArrowUp"===l.key||"w"===l.key?moveBulldozerUp():"ArrowLeft"===l.key||"a"===l.key?moveBulldozerLeft():"ArrowRight"===l.key||"d"===l.key?moveBulldozerRight():"ArrowDown"!==l.key&&"s"!==l.key||moveBulldozerDown()}),span.onclick=function(){modal.style.display="none"},window.onclick=function(l){l.target==modal&&(modal.style.display="none")};
