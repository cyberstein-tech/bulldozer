const renderer=PIXI.autoDetectRenderer({antialias:!0,autoDensity:!0,resolution:window.devicePixelRatio,width:320,height:256,backgroundColor:8421376,autoResize:!0});let stage,tilemap,frame=0,bulldozerRow,bulldozerCol,size=16,mapArray=[],lastMoveArray=[],currentLevel=0,levelSet=-1,levelSetArray=[],levelArray=[];const messages=["Good job!","Awesome!","Props!","Way to go!","Nailed it!","Good Game!","Kudos!","Hats off!","A round of applause...","Keep going!","Slow poke..","Slow down!","Nice!","Take it easy on the caffeine, sheeez","Almost there..","Boom!","Yay, now take a break!","Okay, take a stretch now!","You do not give up, nice!","Bazinga!"],maxRows=16,maxCols=20;let unfillSum,fillSum,bullseyeSum;twoDimensionArray(maxRows,maxCols),loadMap(0),document.getElementById("canvas").appendChild(renderer.view);const loader=new PIXI.Loader;let css_width=window.innerWidth;function makeTilemap(){tilemap.clear();loader.resources;var l=renderer.screen.width,e=renderer.screen.height,e=(size,e/size);Math.floor(e/2);for(let e=fillSum=0;e<20;e++)for(let l=0;l<16;l++){var r=mapArray[l][e];r<0?-8===r?tilemap.tile("brick8.png",e*size,l*size):-7===r?tilemap.tile("brick7.png",e*size,l*size):-6===r?tilemap.tile("brick6.png",e*size,l*size):-5===r?tilemap.tile("brick5.png",e*size,l*size):-4===r?tilemap.tile("brick4.png",e*size,l*size):-3===r?tilemap.tile("brick3.png",e*size,l*size):-2===r?tilemap.tile("brick2.png",e*size,l*size):tilemap.tile("brick1.png",e*size,l*size):0<r&&(1===r?tilemap.tile("bullseye.png",e*size,l*size):2===r?tilemap.tile("boulder.png",e*size,l*size):3===r?(tilemap.tile("bullseye-boulder.png",e*size,l*size),fillSum++):(r%10==4?tilemap.tile("bulldozer-up.png",e*size,l*size):r%10==5?tilemap.tile("bulldozer-down.png",e*size,l*size):r%10==6?tilemap.tile("bulldozer-left.png",e*size,l*size):tilemap.tile("bulldozer-right.png",e*size,l*size),bulldozerRow=l,bulldozerCol=e))}}async function twoDimensionArray(r,o){for(let l=0;l<r;l++)mapArray[l]=[];for(let e=0;e<r;e++)for(let l=0;l<o;l++)mapArray[e][l]=-4;return mapArray}async function getMapSetData(e){e="mapsets/"+e+".txt";try{let l=await fetch(e);if(200===l.status)return l.text();console.log(l.status)}catch(l){console.log(l)}}async function loadMap(e){if(Math.floor(e/10)!=levelSet){levelSet=Math.floor(e/10);let l=await getMapSetData(levelSet);if(null==l)return alert("Unable to fetch map data. Maybe try again?"),null;levelSetArray=[],levelSetArray=l.split(/\r\n|\n\r|\n|\r/)}loadLevelData(e)}async function loadLevelData(l){levelArray=[];var e=l%10;levelArray=levelSetArray[e].split(/\s+/);let r=0;bullseyeSum=0,unfillSum=0;for(let e=fillSum=0;e<maxRows;e++)for(let l=0;l<maxCols;l++)mapArray[e][l]=Number(levelArray[r++]),1===mapArray[e][l]&&unfillSum++,3===mapArray[e][l]&&fillSum++;currentLevel=l,document.getElementById("level").textContent="Level "+currentLevel,bullseyeSum=unfillSum+fillSum}async function restartLevel(){await loadLevelData(currentLevel),makeTilemap()}async function undoLastMove(){mapArray[lastMoveArray[0]][lastMoveArray[1]]=lastMoveArray[2],mapArray[lastMoveArray[3]][lastMoveArray[4]]=lastMoveArray[5],mapArray[lastMoveArray[6]][lastMoveArray[7]]=lastMoveArray[8],makeTilemap()}async function jumpToLevel(l){l&&(await loadMap(l),makeTilemap())}function getLevel(){var l=prompt("Please enter a level number between 0 and 179, inclusive.");!isNaN(l)&&0<=l&&l<180?jumpToLevel(l):alert("Please enter a valid level number. Stop trying to hack me with bad characters.")}function moveBulldozerUp(){var l,e,r;let o=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow-1][bulldozerCol],r=mapArray[bulldozerRow-2][bulldozerCol],!(e<0)){if(0===e)mapArray[bulldozerRow-1][bulldozerCol]=4,o=!0;else if(1===e)mapArray[bulldozerRow-1][bulldozerCol]=14,o=!0;else if(2===e)if(0==r)mapArray[bulldozerRow-1][bulldozerCol]=4,mapArray[bulldozerRow-2][bulldozerCol]=2,o=!0;else{if(1!=r)return;mapArray[bulldozerRow-1][bulldozerCol]=4,mapArray[bulldozerRow-2][bulldozerCol]=3,fillSum++,o=!0}else if(0==r)mapArray[bulldozerRow-1][bulldozerCol]=14,mapArray[bulldozerRow-2][bulldozerCol]=2,fillSum--,o=!0;else{if(1!=r)return;mapArray[bulldozerRow-1][bulldozerCol]=14,mapArray[bulldozerRow-2][bulldozerCol]=3,o=!0}1==o&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow-1,bulldozerCol,e,bulldozerRow-2,bulldozerCol,r)),updateT0Postion(l)}}function moveBulldozerLeft(){var l,e,r;let o=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow][bulldozerCol-1],r=mapArray[bulldozerRow][bulldozerCol-2],!(e<0)){if(0===e)mapArray[bulldozerRow][bulldozerCol-1]=6,o=!0;else if(1===e)mapArray[bulldozerRow][bulldozerCol-1]=16,o=!0;else if(2===e)if(0==r)mapArray[bulldozerRow][bulldozerCol-1]=6,mapArray[bulldozerRow][bulldozerCol-2]=2,o=!0;else{if(1!=r)return;mapArray[bulldozerRow][bulldozerCol-1]=6,mapArray[bulldozerRow][bulldozerCol-2]=3,fillSum++,o=!0}else if(0==r)mapArray[bulldozerRow][bulldozerCol-1]=16,mapArray[bulldozerRow][bulldozerCol-2]=2,fillSum--,o=!0;else{if(1!=r)return;mapArray[bulldozerRow][bulldozerCol-1]=16,mapArray[bulldozerRow][bulldozerCol-2]=3,o=!0}1==o&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow,bulldozerCol-1,e,bulldozerRow,bulldozerCol-2,r)),updateT0Postion(l)}}function moveBulldozerRight(){var l,e,r;let o=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow][bulldozerCol+1],r=mapArray[bulldozerRow][bulldozerCol+2],!(e<0)){if(0===e)mapArray[bulldozerRow][bulldozerCol+1]=7,o=!0;else if(1===e)mapArray[bulldozerRow][bulldozerCol+1]=17,o=!0;else if(2===e)if(0==r)mapArray[bulldozerRow][bulldozerCol+1]=7,mapArray[bulldozerRow][bulldozerCol+2]=2,o=!0;else{if(1!=r)return;mapArray[bulldozerRow][bulldozerCol+1]=7,mapArray[bulldozerRow][bulldozerCol+2]=3,fillSum++,o=!0}else if(0==r)mapArray[bulldozerRow][bulldozerCol+1]=17,mapArray[bulldozerRow][bulldozerCol+2]=2,fillSum--,o=!0;else{if(1!=r)return;mapArray[bulldozerRow][bulldozerCol+1]=17,mapArray[bulldozerRow][bulldozerCol+2]=3,o=!0}1==o&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow,bulldozerCol+1,e,bulldozerRow,bulldozerCol+2,r)),updateT0Postion(l)}}function moveBulldozerDown(){var l,e,r;let o=!1;if(l=mapArray[bulldozerRow][bulldozerCol],e=mapArray[bulldozerRow+1][bulldozerCol],r=mapArray[bulldozerRow+2][bulldozerCol],!(e<0)){if(0===e)mapArray[bulldozerRow+1][bulldozerCol]=5,o=!0;else if(1===e)mapArray[bulldozerRow+1][bulldozerCol]=15,o=!0;else if(2===e)if(0==r)mapArray[bulldozerRow+1][bulldozerCol]=5,mapArray[bulldozerRow+2][bulldozerCol]=2,o=!0;else{if(1!=r)return;mapArray[bulldozerRow+1][bulldozerCol]=5,mapArray[bulldozerRow+2][bulldozerCol]=3,fillSum++,o=!0}else if(0==r)mapArray[bulldozerRow+1][bulldozerCol]=15,mapArray[bulldozerRow+2][bulldozerCol]=2,fillSum--,o=!0;else{if(1!=r)return;mapArray[bulldozerRow+1][bulldozerCol]=15,mapArray[bulldozerRow+2][bulldozerCol]=3,o=!0}1==o&&(lastMoveArray=[],lastMoveArray.push(bulldozerRow,bulldozerCol,l,bulldozerRow+1,bulldozerCol,e,bulldozerRow+2,bulldozerCol,r)),updateT0Postion(l)}}function updateT0Postion(l){if(mapArray[bulldozerRow][bulldozerCol]=10<l?1:0,makeTilemap(),fillSum===bullseyeSum){let e=Number(currentLevel)+1;setTimeout(()=>{var l=currentLevel%20;conVal=confirm(messages[l]+"\n\nLoading level "+e+" now..."),1==conVal&&jumpToLevel(e)},500)}}640<=css_width?(resize(640,512),size=32,loader.add("TilemapLegend","assets/TilemapLegend32.json")):css_width<640&&480<=css_width?(resize(480,384),size=24,loader.add("TilemapLegend","assets/TilemapLegend24.json")):loader.add("TilemapLegend","assets/TilemapLegend16.json"),loader.load((l,e)=>{stage=new PIXI.Container,tilemap=new PIXI.tilemap.CompositeTilemap,stage.addChild(tilemap),PIXI.Ticker.shared.add(()=>renderer.render(stage)),makeTilemap()}),document.addEventListener("keydown",function(l){"ArrowUp"===l.key||"w"===l.key?moveBulldozerUp():"ArrowLeft"===l.key||"a"===l.key?moveBulldozerLeft():"ArrowRight"===l.key||"d"===l.key?moveBulldozerRight():"ArrowDown"!==l.key&&"s"!==l.key||moveBulldozerDown()});var modal=document.getElementById("myModal");let span=document.getElementsByClassName("close")[0];function showAbout(){modal.style.display="block"}function resize(l,e){renderer.resize(l,e)}span.onclick=function(){modal.style.display="none"},window.onclick=function(l){l.target==modal&&(modal.style.display="none")};
